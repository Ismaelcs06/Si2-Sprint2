{% extends "base.html" %}
{% block title %}Actores{% endblock %}

{% block content %}
<div class="col-12">
  <!-- Encabezado -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="m-0">
      üë• Lista de Actores
      {% if tipo %}
        <small class="text-muted">({{ tipo }})</small>
      {% endif %}
    </h3>
    <a href="{% url 'accounts:user_list' %}" class="btn btn-outline-primary btn-sm">
      ‚Üê Volver a usuarios
    </a>
  </div>

  <!-- Filtro por tipo -->
  <form method="get" class="mb-4">
    <div class="row g-2 align-items-center">
      <div class="col-auto">
        <label class="form-label mb-0 fw-semibold">Filtrar por tipo:</label>
      </div>
      <div class="col-auto">
        <select name="tipo" class="form-select form-select-sm" onchange="this.form.submit()">
          <option value="" {% if not tipo %}selected{% endif %}>Todos</option>
          <option value="ABO" {% if tipo == 'ABO' %}selected{% endif %}>Abogados</option>
          <option value="CLI" {% if tipo == 'CLI' %}selected{% endif %}>Clientes</option>
          <option value="ASI" {% if tipo == 'ASI' %}selected{% endif %}>Asistentes</option>
        </select>
      </div>
    </div>
  </form>

  <!-- Tabla -->
  <div class="table-responsive stack-xs table-xs-compact">
    <table class="table table-hover align-middle shadow-sm">
      <thead class="table-light">
        <tr>
          <th>Tipo</th>
          <th>Nombre completo</th>
          <th>CI</th>
          <th>Tel√©fono</th>
          <th>Usuario</th>
          <th>Estado</th>
          <th class="text-end">Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for item in actores_data %}
          {% with a=item.actor %}
          <tr>
            <!-- Tipo -->
            <td data-label="Tipo">
              {% if a.tipoActor == "ABO" %}
                üßë‚Äç‚öñÔ∏è Abogado
              {% elif a.tipoActor == "CLI" %}
                üë§ Cliente
              {% elif a.tipoActor == "ASI" %}
                üßë‚Äçüíº Asistente
              {% else %}
                {{ a.tipoActor }}
              {% endif %}
            </td>

            <!-- Nombre -->
            <td data-label="Nombre completo" class="fw-semibold">
              {{ a.nombres }} {{ a.apellidoPaterno }} {{ a.apellidoMaterno }}
            </td>

            <!-- CI -->
            <td data-label="CI">{{ a.ci }}</td>

            <!-- Tel√©fono -->
            <td data-label="Tel√©fono">{{ a.telefono|default:"‚Äî" }}</td>

            <!-- Usuario -->
            <td data-label="Usuario">
              {% if a.usuario %}
                <span class="text-primary">{{ a.usuario.username }}</span>
              {% else %}
                <span class="text-muted">‚Äî</span>
              {% endif %}
            </td>

            <!-- Estado -->
            <td data-label="Estado">
              <span class="badge {% if a.estadoActor == 'ACTIVO' %}bg-success{% else %}bg-secondary{% endif %}">
                {{ a.estadoActor }}
              </span>
            </td>

            <!-- Acciones -->
            <td class="text-end">
              <div class="btn-group">
                <a href="{% url 'accounts:actor_detail' a.id %}" class="btn btn-outline-primary btn-sm" title="Ver detalle">üëÅ</a>
                {% if item.info_completa %}
                  <span class="badge bg-success align-self-center ms-2">Completo</span>
                {% else %}
                  <a href="{{ item.enlace_completar }}" class="btn btn-outline-warning btn-sm" title="Completar datos">‚úèÔ∏è</a>
                {% endif %}
              </div>
            </td>
          </tr>
          {% endwith %}
        {% empty %}
          <tr>
            <td colspan="7" class="text-center text-muted py-3">
              No se encontraron actores.
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
