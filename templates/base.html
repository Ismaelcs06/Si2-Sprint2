{% load static %}
<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Fuentes -->
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400&family=Poppins:wght@300;400;500&family=Source+Serif+Pro:wght@400;600&display=swap"
    rel="stylesheet">

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <!-- Estilos globales del layout/sidebar -->
  <link href="{% static 'css/sidebar.css' %}" rel="stylesheet">

  {% block extra_css %}{% endblock %}
  <title>{% block title %}GestDocu{% endblock %}</title>
</head>

<body>
  <!-- Sidebar -->

  <aside class="sidebar bg-dark text-white p-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="m-0">GestDocu</h3>
      <button id="sidebarToggle" class="btn btn-outline-light btn-sm">
        <i class="fa fa-bars"></i>
      </button>
    </div>

    <div class="side-inner">
      <div class="profile text-center mb-3">
        <img src="{% static 'img/person_4.jpg' %}" alt="Avatar" class="img-fluid rounded-circle mb-2" width="80">
        <h5 class="name mb-0">{{ request.user.username|default:'Invitado' }}</h5>
        <small class="text-light-50">
          {% if request.user.is_authenticated and request.user.groups.all %}
          {{ request.user.groups.first.name }}
          {% else %}
          Sin rol
          {% endif %}
        </small>
      </div>

      <div class="nav-menu">
        <ul class="list-unstyled">

          <!-- Bitácora -->
          <li class="mb-2">
            <button class="btn w-100 text-start text-white" type="button" data-bs-toggle="collapse"
              data-bs-target="#menuBitacora">
              <i class="fa-solid fa-clock-rotate-left me-2"></i> Bitácora
            </button>
            <div id="menuBitacora" class="collapse">
              <ul class="list-unstyled ps-3">
                <li>
                  <a href="{% url 'seguridad:bitacora_list' %}" class="text-white text-decoration-none">
                    <i class="fa-regular fa-list-alt me-2"></i> Lista de Bitácoras
                  </a>
                </li>
              </ul>
            </div>
          </li>

          <!-- Dashboard -->
          <li class="mb-2">
            <button class="btn w-100 text-start text-white" type="button" data-bs-toggle="collapse"
              data-bs-target="#menuDashboard">
              <i class="fa-solid fa-chart-pie me-2"></i> Dashboard
            </button>
            <div id="menuDashboard" class="collapse">
              <ul class="list-unstyled ps-3">
                <li>
                  <a href="{% url 'dashboard:panel' %}" class="text-white text-decoration-none">
                    <i class="fa-solid fa-chart-line me-2"></i> Panel
                  </a>
                </li>
              </ul>
            </div>
          </li>

          <!-- Usuarios -->
          <li class="mb-2">
            <button class="btn w-100 text-start text-white" type="button" data-bs-toggle="collapse"
              data-bs-target="#menuUsuarios">
              <i class="fa-solid fa-user-shield me-2"></i> Gestionar Usuarios
            </button>
            <div id="menuUsuarios" class="collapse">
              <ul class="list-unstyled ps-3">
                <li><a href="{% url 'accounts:roles_list' %}" class="text-white text-decoration-none">
                    <i class="fa-solid fa-id-badge me-2"></i> Roles</a></li>
                <li><a href="{% url 'accounts:user_list' %}" class="text-white text-decoration-none">
                    <i class="fa-solid fa-users me-2"></i> Usuarios</a></li>
                <li><a href="{% url 'accounts:user_create' %}" class="text-white text-decoration-none">
                    <i class="fa-solid fa-user-plus me-2"></i> Crear Usuario</a></li>
                <li><a href="{% url 'accounts:actors_list' %}" class="text-white text-decoration-none">
                    <i class="fa-solid fa-user-tie me-2"></i> Lista de Actores</a></li>
              </ul>
            </div>
          </li>

          <!-- Inteligencia Artificial -->
          <li class="mb-2">
            <button class="btn w-100 text-start text-white" type="button" data-bs-toggle="collapse"
              data-bs-target="#menuIA">
              <i class="fa-solid fa-robot me-2"></i> Inteligencia Artificial
            </button>
            <div id="menuIA" class="collapse">
              <ul class="list-unstyled ps-3">
                <li>
                  <a href="{% url 'chat:chat' %}" class="text-white text-decoration-none">
                    <i class="fa-solid fa-comments me-2"></i> ChatBot
                  </a>
                </li>
              </ul>
            </div>
          </li>

          <!-- Casos -->
          <li class="mb-2">
            <button class="btn w-100 text-start text-white" type="button" data-bs-toggle="collapse"
              data-bs-target="#menuCasos">
              <i class="fa-solid fa-briefcase me-2"></i> Gestionar Casos y Expedientes
            </button>
            <div id="menuCasos" class="collapse">
              <ul class="list-unstyled ps-3">
                <li><a href="{% url 'casos:case_list' %}" class="text-white text-decoration-none">
                    <i class="fa-solid fa-list me-2"></i> Lista de Casos</a></li>
                <li><a href="{% url 'casos:case_create' %}" class="text-white text-decoration-none">
                    <i class="fa-solid fa-square-plus me-2"></i> Nuevo Caso</a></li>
                <li><a href="{% url 'casos:expediente_list' %}" class="text-white text-decoration-none">
                    <i class="fa-solid fa-folder-closed me-2"></i> Lista de Expedientes</a></li>
                <li><a href="{% url 'casos:carpeta_global_list' %}" class="text-white text-decoration-none">
                    <i class="fa-solid fa-folder-tree me-2"></i> Lista de Carpetas</a></li>
              </ul>
            </div>
          </li>


          <!-- Documentos -->
          <li class="mb-2">
            <button class="btn w-100 text-start text-white" type="button" data-bs-toggle="collapse"
              data-bs-target="#menuDocumentos">
              <i class="fa-solid fa-folder-open me-2"></i> Gestionar Documentos
            </button>
            <div id="menuDocumentos" class="collapse">
              <ul class="list-unstyled ps-3">
                <li><a href="{% url 'documentos:documento_list' %}" class="text-white text-decoration-none">
                    <i class="fa-regular fa-file-lines me-2"></i> Lista de Documentos</a></li>
                <li><a href="{% url 'documentos:tipo_documento_list' %}" class="text-white text-decoration-none">
                    <i class="fa-solid fa-tags me-2"></i> Tipos de Documentos</a></li>
                <li><a href="{% url 'documentos:etapa_procesal_list' %}" class="text-white text-decoration-none">
                    <i class="fa-solid fa-layer-group me-2"></i> Etapas Procesales</a></li>
                <li><a href="{% url 'documentos:documento_create' %}" class="text-white text-decoration-none">
                    <i class="fa-solid fa-plus me-2"></i> Nuevo Documento</a></li>
                <li><a href="{% url 'documentos:carpeta_raiz' %}" class="text-white text-decoration-none">
                    <i class="fa-solid fa-folder-tree me-2"></i> Explorar Carpetas</a></li>
              </ul>
            </div>
          </li>

          <!-- Reportes -->
          <li class="mb-2">
            <button class="btn w-100 text-start text-white" type="button" data-bs-toggle="collapse"
              data-bs-target="#menuReportes">
              <i class="fa-solid fa-chart-column me-2"></i> Reportes y Análisis
            </button>
            <div id="menuReportes" class="collapse">
              <ul class="list-unstyled ps-3">
                <li>
                  <a href="{% url 'reportes:builder' %}" class="text-white text-decoration-none">
                    <i class="fa-solid fa-table-list me-2"></i> Generador de Reportes
                  </a>
                </li>
                <li>
                  <a href="{% url 'reportes:export_html' %}" class="text-white text-decoration-none">
                    <i class="fa-regular fa-file-lines me-2"></i> Último Reporte (HTML)
                  </a>
                </li>
                <li>
                  <a href="{% url 'reportes:export_xlsx' %}" class="text-white text-decoration-none">
                    <i class="fa-solid fa-file-excel me-2"></i> Último Reporte (Excel)
                  </a>
                </li>
                <li>
                  <a href="{% url 'reportes:export_pdf' %}" class="text-white text-decoration-none">
                    <i class="fa-solid fa-file-pdf me-2"></i> Último Reporte (PDF)
                  </a>
                </li>
              </ul>
            </div>
          </li>


          <!-- Logout -->
          <li class="mt-4">
            <form id="logout-form" action="{% url 'logout' %}" method="post">
              {% csrf_token %}
              <button type="submit" class="btn btn-outline-light w-100">
                <i class="fa-solid fa-right-from-bracket me-2"></i> Cerrar Sesión
              </button>
            </form>
          </li>

        </ul>
      </div>
    </div>
  </aside>


  <!-- Topbar móvil (solo visible en <992px) -->
  <div class="mobile-topbar d-lg-none">
    <button class="btn btn-light btn-sm" data-toggle="sidebar" aria-label="Abrir menú">
      <i class="fa fa-bars"></i>
    </button>
  </div>


  <!-- Contenido principal -->
  <main class="p-4 flex-grow-1 bg-light" id="main-content">
    <div class="container-fluid">
      {% block content %}{% endblock %}
    </div>
  </main>

  <!-- Bootstrap 5 JS (incluye Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Script del sidebar -->
  <script src="{% static 'js/sidebar.js' %}"></script>


  {% block extra_js %}{% endblock %}

  <!-- Chat Widget Flotante (solo para usuarios autenticados) -->
  {% if user.is_authenticated %}
  {% include 'chat/chat_widget.html' %}
  {% endif %}
</body>

</html>